第五章  存储Node程序中的数据

    本章内容
        内存和文件系统数据存储
        传统的关系型数据存储
        非关系型数据存储

    选择合适的存储机制取决于以下五个因素：
        存储什么数据
        为了保证性能，要有多块的数据读取和写入速度
        有多少数据
        钥怎么查询数据
        数据要保存多久，对可靠性有什么要求

    本章会讨论三种不同的选择：
        存储数据而无需安装和配置DBMS
        用关系型数据库存储数据，具体说就是MySQL和PostgreSQL
        用NoSQL数据库存储数据，具体说就是Redis、MongoDB和Mongoose


5.1 无服务器的数据存储
   内存存储  文件存储

5.1.1 内存存储
    服务器重启后丢失
    例如：每次服务器重启后 统计页面访问次数的程序
    counter.js

    对于需要把数据存起来，在程序和服务器重启后能持久化的程序，
    基于文件的存储可能更合适。

5.1.2 文件存储
    经常用于存储方式保存程序的配置信息
    也可以用作数据的持久化
    这些数据在程序和服务器重启后依然有效

    并发问题
        两个用户会同时加载相同的文件进行修改
        一个版本会覆盖另一个
        导致某个用户的修改丢失
        对于多用户而言
        数据库管理系统使更合理的选择
        因为他们就是为应多并发问题而生的
    为了阐述如何使用基于文件的存储方式，
    将基于上一章的web 代办事项列表创建简单的命令行版本。
    把任务存储到.tasks文件中，跟运行的脚本在同一目录下。
    在保存之前，任务会被转换成JSON格式，从件中读出来的时候再从JSON格式转回来。

    穿件这个程序需要编写启动逻辑，并定义获取及存储任务的函数。

    1、编写启动逻辑
        这段逻辑从引入必须的模块开始，
        然后解析来自命令行参数的任务命令和描述
        并指明用来保存任务的文件
    2、定义获取任务的辅助函数
    3、定义一个存放任务的辅助函数

5.2 关系型数据库管理系统
    关系数据库管理系统可以存储复杂的信息，并且查询起来很容易。
    RDBMS历来被用在相对高端的程序上，比如内容管理、客户关系管理和购物车。
    本节会看一看MySQL和PostSQL。

5.2.1 MySQL
    1、用MySQL构建一个工作跟踪程序
        创建一个web程序，用来记录你是如何度过工作日的。
        需要记录工作日的日期，花在工作上的事件，以及工作完成情况
        表单，用来输入工作的详细信息
        工作信息输入后，可以被归档或删除

        比起使用文件系统存储数据，RDBMS生成报表更容易，不用读取所有数据到内存中并检查记录的日期。

        构建工作记录程序需要完成下面这几项任务：
        创建程序逻辑
        创建程序需工作所需的辅助函数
        编写让你可以用MySQL添加、删除、更新和获取数据的函数
        编写渲染HTML记录和表单的代码

        这个程序会用Node内置的http模块实现web服务器的功能，用一个第三方模块跟mysql服务器交互
        一个名为timetrack的定制模块，它使程序特有的函数，用来在Mysql中存储、修改和获取数据

        安装mysql第三方模块node-mysql
        npm install mysql

    2、创建程序的逻辑
        创建两个文件存放程序逻辑
        分别是：timetrack_server.js  timetrack.js
        timetrack_server.js包含：
            node的http模块
            程序特定逻辑
            mysql api

            mysql配置需要填入host user password database
    3、创建辅助函数发送HTML，创建表单，接受表单数据
        包含node query string API
        用来发送HTML 接受表单数据的辅助函数
    4、用MySQL田间数据
    5、删除MySQL数据
    6、更新MySQL数据
    7、获取MySQL数据
    8、渲染MySQL记录
    9、渲染HTML表单
    10、试用一下

5.2.2 PostgreSQL
    1、链接POSTGRESQL
    2、往数据库表里插入一条记录
    3、创建返回结果的查询


5.3 NoSQL数据库
    5.3.1 Redis